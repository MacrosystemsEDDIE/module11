---
title: "Module 5: Introduction to Ecological Forecasting - Student Handout"
output: 
   word_document:
    reference_docx: report-style.docx
---

```{r setup, include=FALSE}
#options(kableExtra.auto_format = FALSE)
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
time <- Sys.time()

# Read in assessment questions
quest <- read.csv("data/handout_questions.csv", row.names = 1)
module_text <- read.csv("data/module_text.csv", row.names = 1, header = FALSE)

site_tab <- data.frame("Characteristic" = c(substr(quest["q3a", ], 3, nchar(quest["q3a", ])),substr(quest["q3b", ], 3, nchar(quest["q3b", ])),substr(quest["q3c", ], 3, nchar(quest["q3c", ])),substr(quest["q3d", ], 3, nchar(quest["q3d", ])),substr(quest["q3e", ], 3, nchar(quest["q3e", ]))),
                       "Answer" = rep("",5))

env_var_tab <- data.frame("Variable" = rep("",10),
                          "Units" = rep("",10),
                          "Mean" = rep("",10),
                          "Minimum" = rep("",10),
                          "Maximum" = rep("",10))

env_var_rel <- data.frame("Target" = rep("",10),
                          "Variable" = rep("",10),
                          "Relationship" = rep("",10))

state_par <- data.frame("States" = rep("",2),
                        "Parameters" = rep("",2))

```

![](www/report-header.png)

***
### Name: 
### Student ID: 
#### Completed on: 
#### Copy-paste your save progress link from the Shiny app here for ease of reference:
***

# **Macrosystems EDDIE Module 11: Time Series Modeling and Prediction of Environmental Data**


# Learning Objectives:

In the course of this module, you will:

- Explore relationships between ecological variables from two different environmental case studies.
- Understand the model structure of four time series models that are commonly applied in ecology and environmental science.
- Fit time series models using environmental datasets and assess the importance of various ecological variables in making model predictions.
- Manipulate environmental datasets into standardized formats suitable for training and assessing data-driven models.
- Compare multiple data-driven models to assess model performance on out-of-sample predictions.


# Summary:

Advances in environmental sensor technology in recent decades permit collection of environmental data at high temporal frequencies (e.g., every 10 minutes) across many ecosystems. These time series of environmental data can be used to gain information about the previous and current state of ecosystems, as well as make predictions about ecosystem states in the future. To help researchers and managers understand the complex patterns that can occur in high-frequency time series data, time series models are commonly applied in ecology and environmental science. These models use statistical and machine learning methods to identify signals in high-frequency environmental data.

In this module, students will apply several different time series and machine learning models to environmental data. They will explore data from an environmental case study of their choice, choose which environmental variables to use to fit a time series model, assess the model, and use it to make predictions. Then, they will fit several other models to the same time series data and compare predictive performance across models. They will also evaluate the ecological implications that can be drawn from each model (e.g., which variables are important for explaining the dynamics of the target variable for prediction).

## Module overview:

- Introduce concepts related to time series modeling and environmental data case studies
- Activity A: Visualize data from a selected environmental data case study and fit and assess a time series model
- Activity B: Choose a new environmental dataset or upload your own dataset and fit and assess a time series model
- Activity C: Fit additional time series models to your environmental dataset and compare performance across models


## Today's focal question: _How can we use time series models to understand and predict the state of ecosystems?_

To address this question, we will introduce several time series models that are commonly applied in ecology and environmental science. We will also introduce the importance of using standardized datasets and out-of-sample prediction to train and assess time series models. We will fit a model that predicts a target variable that is important for ecosystem management. We will make out-of-sample predictions with this model to assess model fit, also examine the uncertainty associated with our predictions. Then, we will format and upload a standardized dataset and fit several models to generate out-of-sample predictions for an environmental case study that is relevant to your coursework. Finally, we will compare performance across models and draw inference regarding which ecological variables are important for predicting the target variable of management concern.
  
We will be using ecological data collected by the Swan-Canning Estuary Virtual Observatory (SCEVO) in Western Australia and the National Ecological Observation Network (NEON) in the United STates to tackle this question. SCEVO is a monitoring network to observe water quality in the Swan and Canning Rivers in Perth, Australia, which are important drinking water supplies. NEON is a continental-scale observatory designed to collect publicly-available, long-term ecological data to monitor changing ecosystems across the U.S. 

Our focal target variable for the SCEVO dataset will be chlorophyll-a, a measure of aquatic primary productivity. Chlorophyll-a is an important ecosystem variable because it can indicate when a harmful algal bloom is occurring. High levels of chlorophyll-a may indicate a bloom, which can have deleterious effects on water quality through release of toxins, formation of surface scums, and depletion of dissolved oxygen in the water. 

The target variable for the NEON dataset will be net ecosystem exchange (NEE), a measure of carbon dioxide flux from terrestrial ecosystems. NEE indicates whether an ecosystem is emitting or taking up greenhouse gasses, and how this changes over time.
  
  
## R Shiny App:

The lesson content is hosted on an R Shiny App at [https://macrosystemseddie.shinyapps.io/module11/](https://macrosystemseddie.shinyapps.io/module11/)  
This can be accessed via any internet browser and allows you to navigate through the lesson via this app. You will fill in the questions below on this handout as you complete the lesson activities.

## Optional pre-class readings and videos:

- Tredennick, A. T., Hooker, G., Ellner, S. P., & Adler, P. B. (2021). A practical guide to selecting models for exploration, inference, and prediction in ecology. Ecology, 102(6), e03336. [https://doi.org/10.1002/ecy.3336](https://doi.org/10.1002/ecy.3336)

- Wickham, H., Ã‡etinkaya-Rundel, M., and Grolemund, G. (2023) R for Data Science (2nd ed.), [Chapter 5: Data Tidying.](https://r4ds.hadley.nz/data-tidy.html)
\

## Pre-class activity: Explore environmental case study
Choose one of the papers describing an environmental case study and use it to answer the questions below. Choose a case study that you will work with for Activity A of the module.
\

- Huang, P., Trayler, K., Wang, B., Saeed, A., Oldham, C. E., Busch, B., & Hipsey, M. R. (2019). An integrated modelling system for water quality forecasting in an urban eutrophic estuary: The Swan-Canning Estuary virtual observatory. Journal of Marine Systems, 199, 103218. [https://doi.org/10.1016/j.jmarsys.2019.103218](https://doi.org/10.1016/j.jmarsys.2019.103218)

\

#### Pre-class questions: Choose one of the environmental case studies above and use the paper to answer the questions below. 
\
A.  Which case study did you select?  

**Answer:** 

\    
B.  What ecological variable(s) are being predicted?  

**Answer:** 

\
C.  How can these predictions help the public and/or managers?

**Answer:** 

\
D.  Describe the way(s) in which the model predictions are assessed (evaluated for accuracy).

**Answer:** 

\
Now navigate to the [Shiny interface](https://macrosystemseddie.shinyapps.io/module11) to answer the rest of the questions.

The questions you must answer are written both in the Shiny interface as well as in this handout. As you go, you should fill out your answers in this document.

# Think about it!
\
Answer the following questions:

1. `r substr(quest["q1", ], 4, nchar(quest["q1", ]))`  

**Answer:** 
\

2. `r substr(quest["q2", ], 4, nchar(quest["q2", ]))`   

**Answer:** 
\



# Activity A: Select an environmental case study, visualize data, and fit a model

## Objective 1: Select case study\

***
`r module_text["obj_01", ]`

***

3. `r substr(quest["q3", ], 4, nchar(quest["q3", ]))`  

*Table 1. Site Characteristics*
```{r}
knitr::kable(site_tab) 
```

4. `r substr(quest["q4", ], 4, nchar(quest["q4", ]))`

## Objective 2: Explore data

***
`r module_text["obj_02", ]`

***

5. `r substr(quest["q5", ], 4, nchar(quest["q5", ]))`

*Table 2. Description of site variables:*  

```{r}
knitr::kable(env_var_tab) 
```

6. `r substr(quest["q6", ], 4, nchar(quest["q6", ]))`

*Table 3. Description of effect of each variable on the target variable*  

```{r}
knitr::kable(env_var_rel) 
```
\


## Objective 3: Learn about ARIMA model\

***
`r module_text["obj_03", ]`

***

7. `r substr(quest["q7", ], 4, nchar(quest["q7", ]))`
\

8. `r substr(quest["q7", ], 4, nchar(quest["q7", ]))`
\

**Download the plot associated with this question and copy-paste it into your report below.**

*Figure 1. Target variable vs. one-day lag of environmental case study target variable*  

9. `r substr(quest["q7", ], 4, nchar(quest["q7", ]))`
\

**Download the plot associated with this question and copy-paste it into your report below.**

*Figure 2. Partial autocorrelation of environmental case study target variable*  

10. `r substr(quest["q7", ], 4, nchar(quest["q7", ]))`
\

**Download the plot associated with this question and copy-paste it into your report below.**

*Figure 3. Differenced time series of environmental case study target variable*  



## Objective 4: Understand model\

***
`r module_text["obj_04", ]`

***

6. `r substr(quest["q6", ], 4, nchar(quest["q6", ]))`  
\
    a.  `r substr(quest["q6a", ], 3, nchar(quest["q6a", ]))`:   
    \
    b.  `r substr(quest["q6b", ], 3, nchar(quest["q6b", ]))`:   
    \
\

7. `r substr(quest["q7", ], 5, nchar(quest["q7", ]))` 
\

*Table 4. Sorted parameters and state variables.*

```{r echo = FALSE, results = "asis"}
knitr::kable(state_par)

```
 
\

8. `r substr(quest["q8", ], 5, nchar(quest["q8", ]))`
\
    a.  `r substr(quest["q8a", ], 3, nchar(quest["q8a", ]))`: 
    b.  `r substr(quest["q8b", ], 3, nchar(quest["q8b", ]))`: 
\

## Objective 5: Build model\

***
`r module_text["obj_05", ]`

***

9. `r substr(quest["q9", ], 5, nchar(quest["q9", ]))`  
\
**Answer:** 

10. `r substr(quest["q10", ], 6, nchar(quest["q10", ]))`
\
**Answer:**   

11. `r substr(quest["q11", ], 6, nchar(quest["q11", ]))`
\
**Answer:**   
\
*Please copy-paste your Q-11-plot.png image here.*\
\
*Figure 1. Modeled primary productivity for your selected NEON lake compared to chlorophyll-a concentrations, a proxy measurement for aquatic primary productivity.*
\
12. `r substr(quest["q12", ], 6, nchar(quest["q12", ]))`
\
13. `r substr(quest["q13", ], 6, nchar(quest["q13", ]))`
\

*Table 5. Calibrated primary productivity model settings.*
```{r}
knitr::kable(mod_sett1) 
```

\

# Activity B: Forecast!

## Objective 6: Examine uncertainty\

***
`r module_text["obj_06", ]`

***

14. `r substr(quest["q14", ], 6, nchar(quest["q14", ]))`  
\
**Answer:** 
\

15. `r substr(quest["q15", ], 6, nchar(quest["q15", ]))`
\
    a.  `r substr(quest["q15a", ], 3, nchar(quest["q15a", ]))`  
    \
    **Answer:**  
    \
    b.  `r substr(quest["q15b", ], 3, nchar(quest["q15b", ]))`  
    \
    **Answer:**   
    \
    c.  `r substr(quest["q15c", ], 3, nchar(quest["q15c", ]))`  
    \
    **Answer:**   
    \
    *Please copy-paste your Q-15-plot.png image here.*\
\
*Figure 2. Weather forecast plot at the selected NEON lake generated from National Oceanic and Atmospheric Administration (NOAA)  [Global Ensemble Forecast System](https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-ensemble-forecast-system-gefs)  (GEFS).* 


## Objective 7: Prepare inputs

***
`r module_text["obj_07", ]`

***

16. `r substr(quest["q16", ], 6, nchar(quest["q16", ]))`  
\
**Answer:** 
\


## Objective 8: Forecast\

***
`r module_text["obj_08", ]`

***

17. `r substr(quest["q17", ], 6, nchar(quest["q17", ]))`  
\
**Answer:**   
\
*Please copy-paste your Q-17-plot.png image here.*\
\
*Figure 3. Ecological forecast for primary productivity at your selected NEON lake for the next 30 days.*  
\

18. `r substr(quest["q18", ], 6, nchar(quest["q18", ]))`\
\
    a.  `r substr(quest["q18a", ], 3, nchar(quest["q18a", ]))`  
    \
    **Answer:**  
    \
    b.  `r substr(quest["q18b", ], 3, nchar(quest["q18b", ]))`  
    \
    **Answer:**   
    \

## Objective 9: Communicate forecast\

***
`r module_text["obj_09", ]`

***

19. `r substr(quest["q19", ], 6, nchar(quest["q19", ]))`  
\
**Answer:**   
\

20. `r substr(quest["q20", ], 6, nchar(quest["q20", ]))`  
\
    a.  `r substr(quest["q20a", ], 3, nchar(quest["q20a", ]))`  
    \
    **Answer:**  
    \
    b.  `r substr(quest["q20b", ], 3, nchar(quest["q20b", ]))`  
    \
    **Answer:**   
    \
    *Please copy-paste your Q-20-visualization.png image here.*\
\
*Figure 4. A visualization of an ecological forecast for primary productivity at your selected NEON lake for the next 30 days. You selected this visualization to optimize forecast communication.*  

\

## Objective 10: Assess forecast\

***
`r module_text["obj_10", ]`

***

21. `r substr(quest["q21", ], 6, nchar(quest["q21", ]))`  
\
    a.  `r substr(quest["q21a", ], 3, nchar(quest["q21a", ]))`  
    \
    **Answer:**  
    \
    b.  `r substr(quest["q21b", ], 3, nchar(quest["q21b", ]))`  
    \
    **Answer:**   
    \
    *Please copy-paste your Q-21-plot.png image here.*\
\
*Figure 5. Assessment of the forecast one week later by comparing the forecast to new observations at your selected NEON lake.*   
\

# Activity C: Complete the forecast cycle

## Objective 11: Update model\

***
`r module_text["obj_11", ]`

***

22. `r substr(quest["q22", ], 6, nchar(quest["q22", ]))`  
\
    a.  `r substr(quest["q22a", ], 3, nchar(quest["q22a", ]))`  
    \
    **Answer:** 
    \
    *Table 6. Calibrated and updated primary productivity model settings.*
    ```{r}
    knitr::kable(mod_sett2) 
    ```
\
    b.  `r substr(quest["q22b", ], 3, nchar(quest["q22b", ]))`  
    \
    **Answer:**   
    \
    *Please copy-paste your Q-22b-plot.png image here.*\
    \
    *Figure 6. Updated forecast by updating the model parameters for your selected NEON lake site.*
\
    c.  `r substr(quest["q22c", ], 3, nchar(quest["q22c", ]))`  
    \
    **Answer:**  
    \
    *Please copy-paste your Q-22c-plot.png image here.*\
    \
    *Figure 7. Assessment of the updated forecast.*   
    \
    d.  `r substr(quest["q22d", ], 3, nchar(quest["q22d", ]))`  
    \
    **Answer:** 
    \
\


## Objective 12: Next forecast\

***
`r module_text["obj_12", ]`

***

23. `r substr(quest["q23", ], 6, nchar(quest["q23", ]))`  
\
    a.  `r substr(quest["q23a", ], 3, nchar(quest["q23a", ]))`  
    \
    **Answer:** 
    \
    *Table 7. Primary productivity model settings for the first forecast, updated forecast, and second forecast.*
    \
    ```{r}
         knitr::kable(mod_sett3) 
    ```
    \
    b.  `r substr(quest["q23b", ], 3, nchar(quest["q23b", ]))`  
    \
    **Answer:**   
    \
    *Please copy-paste your Q-23-plot.png image here.*\
    \
    c.  `r substr(quest["q23c", ], 3, nchar(quest["q23c", ]))`  
    \
    **Answer:**  
    \
  

24. `r substr(quest["q24", ], 6, nchar(quest["q24", ]))`  
\
**Answer:** 
\





This module was developed by Moore, T.N., M.E. Lofton, C.C. Carey, and R.Q. Thomas. 03 July 2023. Macrosystems EDDIE: Introduction to Ecological Forecasting. Macrosystems EDDIE Module 5, Version 2. http://module5.macrosystemseddie.org. Module development was supported by NSF grants DEB-1926050 and DBI-1933016.

This document last modified: 03 July 2023 by MEL.
